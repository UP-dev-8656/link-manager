<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Advanced AI-powered link manager with cloud sync, real-time collaboration, and advanced analytics">
    <meta name="theme-color" content="#4361ee">
    <title>Link Manager Pro v5.2</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ”—</text></svg>">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Marked for markdown support -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Add Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        /* Enhanced CSS Variables & Theme System */
        :root {
            /* Primary Colors */
            --primary-50: #eef2ff;
            --primary-100: #e0e7ff;
            --primary-200: #c7d2fe;
            --primary-300: #a5b4fc;
            --primary-400: #818cf8;
            --primary-500: #6366f1;
            --primary-600: #4f46e5;
            --primary-700: #4338ca;
            --primary-800: #3730a3;
            --primary-900: #312e81;
            --primary-950: #1e1b4b;
            
            --primary-gradient: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-700) 100%);
            --primary-gradient-hover: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-800) 100%);
            
            /* Semantic Colors */
            --success-500: #10b981;
            --warning-500: #f59e0b;
            --danger-500: #ef4444;
            --info-500: #3b82f6;
            
            /* Surface Colors - Light Theme */
            --background-50: #f8fafc;
            --background-100: #f1f5f9;
            --background-200: #e2e8f0;
            --background-300: #cbd5e1;
            --surface-50: #ffffff;
            --surface-100: #f8fafc;
            --surface-200: #f1f5f9;
            --surface-300: #e2e8f0;
            
            /* Text Colors - Light Theme */
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --text-inverse: #ffffff;
            
            /* Border & Shadow */
            --border-color: #e2e8f0;
            --border-color-hover: #cbd5e1;
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.08), 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.1), 0 10px 10px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px rgba(0, 0, 0, 0.15);
            
            /* Radius */
            --radius-xs: 4px;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-2xl: 24px;
            --radius-full: 9999px;
            
            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Typography */
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', Monaco, 'Cascadia Code', monospace;
            
            /* Z-index layers */
            --z-dropdown: 10;
            --z-sticky: 20;
            --z-fixed: 30;
            --z-modal: 40;
            --z-popover: 50;
            --z-tooltip: 60;
            --z-toast: 70;
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --background-50: #0f172a;
            --background-100: #1e293b;
            --background-200: #334155;
            --background-300: #475569;
            --surface-50: #1e293b;
            --surface-100: #334155;
            --surface-200: #475569;
            --surface-300: #64748b;
            
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            
            --border-color: #334155;
            --border-color-hover: #475569;
        }

        /* Midnight Theme */
        [data-theme="midnight"] {
            --primary-500: #8b5cf6;
            --primary-700: #7c3aed;
            
            --background-50: #030712;
            --background-100: #111827;
            --background-200: #1f2937;
            --background-300: #374151;
            --surface-50: #111827;
            --surface-100: #1f2937;
            --surface-200: #374151;
            --surface-300: #4b5563;
            
            --text-primary: #f9fafb;
            --text-secondary: #e5e7eb;
            --text-tertiary: #9ca3af;
            
            --border-color: #374151;
            --border-color-hover: #4b5563;
        }

        /* Base Reset */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-sans);
            background: var(--background-50);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color var(--transition-normal);
        }

        /* Enhanced Container System */
        .container {
            width: 100%;
            max-width: 1800px;
            margin: 0 auto;
            padding: var(--spacing-md);
        }

        /* Enhanced Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.25;
            margin-bottom: var(--spacing-md);
        }

        .h1 { font-size: clamp(2rem, 5vw, 3.5rem); }
        .h2 { font-size: clamp(1.5rem, 4vw, 2.5rem); }
        .h3 { font-size: clamp(1.25rem, 3vw, 2rem); }
        .h4 { font-size: clamp(1.125rem, 2.5vw, 1.5rem); }

        /* Enhanced Header with Command Menu */
        .app-header {
            position: sticky;
            top: var(--spacing-md);
            z-index: var(--z-sticky);
            background: var(--surface-50);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-lg) var(--spacing-xl);
            margin: var(--spacing-md) var(--spacing-md) var(--spacing-xl);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-lg);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .logo {
            width: 56px;
            height: 56px;
            background: var(--primary-gradient);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--text-inverse);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .logo::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            animation: shimmer 3s infinite;
        }

        .brand-text h1 {
            font-size: clamp(1.75rem, 4vw, 2.5rem);
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--spacing-xs);
        }

        /* Command Menu */
        .command-menu {
            position: relative;
            flex: 1;
            max-width: 500px;
            min-width: 300px;
        }

        .command-trigger {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--surface-100);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            user-select: none;
        }

        .command-trigger:hover {
            border-color: var(--primary-500);
            background: var(--surface-200);
        }

        .command-trigger kbd {
            background: var(--surface-200);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 2px 6px;
            font-size: 12px;
            font-family: var(--font-mono);
        }

        /* Enhanced Search with Filters */
        .search-container {
            position: relative;
            width: 100%;
            margin-bottom: var(--spacing-xl);
        }

        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background: var(--surface-50);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-sm);
            transition: all var(--transition-normal);
        }

        .search-wrapper:focus-within {
            border-color: var(--primary-500);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .search-input {
            flex: 1;
            padding: var(--spacing-md);
            border: none;
            background: transparent;
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
        }

        .search-filters {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
            padding-right: var(--spacing-sm);
            border-right: 1px solid var(--border-color);
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 6px 12px;
            background: var(--surface-100);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .filter-btn.active {
            background: var(--primary-500);
            color: white;
            border-color: var(--primary-500);
        }

        /* Enhanced Quick Actions with Cards */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .action-card {
            background: var(--surface-50);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .action-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary-500);
            box-shadow: var(--shadow-xl);
        }

        .action-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-gradient);
        }

        .action-icon {
            width: 56px;
            height: 56px;
            background: var(--primary-gradient);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-bottom: var(--spacing-md);
        }

        /* Enhanced Analytics Dashboard */
        .analytics-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .analytics-card {
            background: var(--surface-50);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            position: relative;
            overflow: hidden;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: var(--spacing-xs);
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: 14px;
            color: var(--text-secondary);
        }

        .metric-change.positive {
            color: var(--success-500);
        }

        .metric-change.negative {
            color: var(--danger-500);
        }

        /* Enhanced Link Cards with Context Menu */
        .link-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .link-card {
            background: var(--surface-50);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            position: relative;
            transition: all var(--transition-normal);
            overflow: hidden;
        }

        .link-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary-500);
            box-shadow: var(--shadow-xl);
        }

        .link-card.selected {
            border-color: var(--primary-500);
            background: rgba(99, 102, 241, 0.05);
        }

        .link-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
        }

        .link-favicon {
            width: 48px;
            height: 48px;
            background: var(--surface-100);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--text-secondary);
            overflow: hidden;
        }

        .link-favicon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .link-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface-100);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: none;
        }

        .action-btn:hover {
            background: var(--surface-200);
            color: var(--text-primary);
        }

        .link-preview {
            width: 100%;
            height: 200px;
            background: var(--surface-100);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .link-preview:hover .preview-overlay {
            opacity: 1;
        }

        .preview-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .link-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-md);
        }

        /* Enhanced Modal System */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            padding: var(--spacing-md);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal {
            background: var(--surface-50);
            border-radius: var(--radius-2xl);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow: hidden;
            transform: scale(0.95);
            opacity: 0;
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-2xl);
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
            opacity: 1;
        }

        .modal-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .modal-body {
            padding: var(--spacing-xl);
            overflow-y: auto;
            flex: 1;
        }

        /* Enhanced Form Elements */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-md);
            background: var(--surface-100);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-size: 16px;
            transition: all var(--transition-fast);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .form-hint {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: var(--spacing-xs);
        }

        /* Enhanced Button System */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all var(--transition-normal);
            border: 2px solid transparent;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
        }

        .btn:hover::after {
            animation: shimmer 1.5s infinite;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-gradient-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--surface-100);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--surface-200);
            border-color: var(--primary-500);
        }

        .btn-icon {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: var(--radius-full);
        }

        /* Enhanced Animations */
        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-slide-up { animation: slideUp 0.5s ease-out; }
        .animate-scale-in { animation: scaleIn 0.3s ease-out; }

        /* Enhanced Loading States */
        .skeleton {
            background: linear-gradient(90deg, 
                var(--surface-100) 25%, 
                var(--surface-200) 50%, 
                var(--surface-100) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Enhanced Empty State */
        .empty-state {
            text-align: center;
            padding: var(--spacing-2xl) var(--spacing-md);
            grid-column: 1 / -1;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: var(--spacing-lg);
            opacity: 0.1;
        }

        /* Enhanced Context Menu */
        .context-menu {
            position: fixed;
            background: var(--surface-50);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            z-index: var(--z-popover);
            min-width: 200px;
            display: none;
        }

        .context-menu-item {
            padding: var(--spacing-md);
            cursor: pointer;
            transition: background var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .context-menu-item:hover {
            background: var(--surface-100);
        }

        /* Enhanced Toast System */
        .toast-container {
            position: fixed;
            bottom: var(--spacing-lg);
            left: var(--spacing-lg);
            z-index: var(--z-toast);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .toast {
            background: var(--surface-50);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md) var(--spacing-lg);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            animation: slideUp 0.3s ease-out;
            max-width: 400px;
        }

        /* Tag Container */
        .form-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        /* Enhanced Responsive Design */
        @media (max-width: 1024px) {
            .link-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-sm);
            }
            
            .app-header {
                flex-direction: column;
                text-align: center;
                margin: var(--spacing-sm);
                padding: var(--spacing-md);
            }
            
            .link-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions-grid {
                grid-template-columns: 1fr;
            }
            
            .search-filters {
                display: none;
            }
            
            .command-menu {
                min-width: 100%;
            }
        }

        /* Enhanced Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        :focus-visible {
            outline: 3px solid var(--primary-500);
            outline-offset: 2px;
            border-radius: var(--radius-sm);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface-100);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--surface-300);
            border-radius: var(--radius-full);
            border: 2px solid var(--surface-100);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-500);
        }

        /* Enhanced Utility Classes */
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Enhanced Toggle Switch */
        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 32px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--surface-300);
            border-radius: var(--radius-full);
            transition: var(--transition-normal);
        }

        .toggle-slider::before {
            content: "";
            position: absolute;
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background: white;
            border-radius: 50%;
            transition: var(--transition-normal);
        }

        input:checked + .toggle-slider {
            background: var(--primary-500);
        }

        input:checked + .toggle-slider::before {
            transform: translateX(28px);
        }

        /* Enhanced Progress Bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--surface-200);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: var(--radius-full);
            transition: width var(--transition-normal);
        }

        /* Enhanced Badge System */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            background: var(--surface-200);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 500;
            cursor: default;
        }

        .badge-primary {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-500);
            border-color: rgba(99, 102, 241, 0.2);
        }

        .badge-clickable {
            cursor: pointer;
        }

        .badge-clickable:hover {
            background: var(--surface-300);
        }

        /* Enhanced Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 12px;
            background: var(--surface-50);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-md);
            z-index: var(--z-tooltip);
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-4px);
        }

        /* Enhanced Multi-select */
        .multiselect {
            position: relative;
        }

        .multiselect-input {
            width: 100%;
            padding: var(--spacing-md);
            background: var(--surface-100);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            cursor: pointer;
        }

        .multiselect-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--surface-50);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            margin-top: 4px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: var(--z-dropdown);
        }

        .multiselect-option {
            padding: var(--spacing-md);
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .multiselect-option:hover {
            background: var(--surface-100);
        }

        .multiselect-option.selected {
            background: rgba(99, 102, 241, 0.1);
        }

        /* Enhanced Keyboard Shortcut Display */
        .shortcut {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            background: var(--surface-200);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 2px 6px;
            font-size: 12px;
            font-family: var(--font-mono);
        }

        .shortcut-key {
            padding: 1px 4px;
            background: var(--surface-50);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xs);
        }

        /* Import Modal Styles */
        .import-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .import-option {
            background: var(--surface-100);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .import-option:hover {
            border-color: var(--primary-500);
            background: var(--surface-200);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Enhanced Navigation -->
    <nav class="app-header animate-scale-in">
        <div class="logo-section">
            <div class="logo">ðŸ”—</div>
            <div class="brand-text">
                <h1>Link Manager Pro</h1>
                <p class="subtitle" style="color: var(--text-secondary);">v5.2 | Advanced AI-Powered Link Management</p>
            </div>
        </div>
        
        <div class="command-menu">
            <div class="command-trigger" onclick="openCommandPalette()">
                <i class="fas fa-search"></i>
                <span>Search links, actions, or ask AI...</span>
                <div style="flex: 1;"></div>
                <kbd>Ctrl</kbd> + <kbd>K</kbd>
            </div>
        </div>
        
        <div class="header-actions">
            <div class="theme-switcher" style="display: flex; gap: 8px;">
                <button class="action-btn" data-theme="light" title="Light Mode">
                    <i class="fas fa-sun"></i>
                </button>
                <button class="action-btn" data-theme="dark" title="Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="action-btn" data-theme="midnight" title="Midnight Mode">
                    <i class="fas fa-stars"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Enhanced Search with Filters -->
        <div class="search-container animate-fade-in">
            <div class="search-wrapper">
                <div class="search-filters">
                    <button class="filter-btn active">All</button>
                    <button class="filter-btn">Favorites</button>
                    <button class="filter-btn">Unread</button>
                    <button class="filter-btn">Recent</button>
                </div>
                <input type="text" 
                       class="search-input" 
                       placeholder="Search your links..."
                       id="searchInput"
                       autocomplete="off">
                <div class="search-actions" style="display: flex; gap: 8px; padding-left: 8px;">
                    <button class="action-btn" id="aiSearchBtn" title="AI Search">
                        <i class="fas fa-robot"></i>
                    </button>
                    <button class="action-btn" id="voiceSearchBtn" title="Voice Search">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="action-btn" id="filterBtn" title="Advanced Filters">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
            </div>
            <div id="searchSuggestions" class="multiselect-dropdown"></div>
        </div>

        <!-- Quick Actions Panel -->
        <div class="quick-actions-grid animate-slide-up" style="animation-delay: 0.1s;">
            <div class="action-card" onclick="openAddLinkModal()">
                <div class="action-icon">
                    <i class="fas fa-plus"></i>
                </div>
                <h4>Add Link</h4>
                <p style="color: var(--text-secondary); margin-bottom: 16px;">Add a new link with AI suggestions</p>
                <div class="shortcut">Ctrl + N</div>
            </div>
            
            <div class="action-card" onclick="openImportModal()">
                <div class="action-icon">
                    <i class="fas fa-file-import"></i>
                </div>
                <h4>Import</h4>
                <p style="color: var(--text-secondary); margin-bottom: 16px;">Import from 20+ sources</p>
                <div class="badge">Chrome â€¢ Firefox â€¢ Safari</div>
            </div>
            
            <div class="action-card" onclick="openAIOrganizeModal()">
                <div class="action-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <h4>AI Organize</h4>
                <p style="color: var(--text-secondary); margin-bottom: 16px;">Let AI categorize and tag links</p>
                <div class="badge badge-primary">Powered by GPT-4</div>
            </div>
            
            <div class="action-card" onclick="openAnalyticsModal()">
                <div class="action-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h4>Analytics</h4>
                <p style="color: var(--text-secondary); margin-bottom: 16px;">View detailed usage statistics</p>
                <div class="badge">Real-time</div>
            </div>
        </div>

        <!-- Enhanced Analytics Dashboard (without chart) -->
        <div class="analytics-dashboard animate-fade-in" style="animation-delay: 0.2s;">
            <div class="analytics-card">
                <h4>Total Links</h4>
                <div class="metric-value" id="statTotal">0</div>
                <div class="metric-change">
                    <i class="fas fa-arrow-up"></i>
                    <span>Add your first link!</span>
                </div>
            </div>
            
            <div class="analytics-card">
                <h4>Active Sessions</h4>
                <div class="metric-value" id="statActive">1</div>
                <div class="metric-change">
                    <i class="fas fa-user"></i>
                    <span>You are online</span>
                </div>
            </div>
            
            <div class="analytics-card">
                <h4>Storage Used</h4>
                <div class="metric-value" id="statStorage">0.1 MB</div>
                <div class="progress-bar" style="margin-top: 16px;">
                    <div class="progress-fill" style="width: 5%;"></div>
                </div>
            </div>
        </div>

        <!-- Link Grid with Bulk Actions -->
        <div class="link-grid" id="linkGrid">
            <!-- Links will be dynamically inserted here -->
        </div>

        <!-- Bulk Actions Bar -->
        <div id="bulkActionsBar" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--surface-50); border: 1px solid var(--border-color); border-radius: var(--radius-xl); padding: var(--spacing-md); box-shadow: var(--shadow-xl); z-index: var(--z-fixed);">
            <div style="display: flex; align-items: center; gap: var(--spacing-md); flex-wrap: wrap;">
                <span id="selectedCount" style="font-weight: 600;">0 links selected</span>
                <button class="btn btn-secondary" onclick="linkManager.bulkArchive()">Archive</button>
                <button class="btn btn-secondary" onclick="linkManager.bulkTag()">Tag</button>
                <button class="btn btn-primary" onclick="linkManager.bulkExport()">Export Selected</button>
                <button class="action-btn" onclick="linkManager.clearSelection()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <!-- Pagination Controls -->
        <div id="paginationControls" style="display: none; justify-content: center; align-items: center; gap: var(--spacing-md); margin-top: var(--spacing-xl); padding: var(--spacing-md);">
            <button class="btn btn-secondary" id="prevPage" disabled>
                <i class="fas fa-chevron-left"></i> Previous
            </button>
            <span id="pageInfo" style="color: var(--text-secondary);">Page 1 of 1</span>
            <button class="btn btn-secondary" id="nextPage" disabled>
                Next <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- Enhanced Modals -->
    <div class="modal-overlay" id="addLinkModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Add New Link</h2>
                <button class="btn btn-icon" onclick="closeModal('addLinkModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="linkForm" onsubmit="saveLink(event)">
                    <div class="form-group">
                        <label class="form-label">URL</label>
                        <input type="url" 
                               class="form-input" 
                               id="linkUrl"
                               placeholder="https://example.com"
                               required
                               autocomplete="off">
                        <div class="form-hint">Press Enter to fetch metadata with AI</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
                        <div class="form-group">
                            <label class="form-label">Title</label>
                            <input type="text" 
                                   class="form-input" 
                                   id="linkTitle"
                                   placeholder="Link title"
                                   required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select class="form-input" id="linkCategory">
                                <option value="General">General</option>
                                <option value="Work">Work</option>
                                <option value="Personal">Personal</option>
                                <option value="Learning">Learning</option>
                                <option value="Entertainment">Entertainment</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-input" 
                                  id="linkDescription"
                                  rows="3"
                                  placeholder="Optional description (markdown supported)"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tags</label>
                        <div class="form-tags" id="tagContainer"></div>
                        <input type="text" 
                               class="form-input" 
                               id="tagInput"
                               placeholder="Add tags (press Enter or comma)"
                               autocomplete="off">
                        <div class="form-hint">Popular tags: tutorial, documentation, reference, project</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="linkFavorite">
                            <span style="margin-left: 8px;">Add to favorites</span>
                        </label>
                    </div>
                    
                    <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-xl);">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-save"></i>
                            Save Link
                        </button>
                        <button type="button" 
                                class="btn btn-secondary" 
                                onclick="closeModal('addLinkModal')"
                                style="flex: 1;">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Import Links</h2>
                <button class="btn btn-icon" onclick="closeModal('importModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="import-options">
                    <div class="import-option" onclick="importFromBrowser()">
                        <i class="fas fa-globe" style="font-size: 32px; margin-bottom: 12px; color: var(--primary-500);"></i>
                        <h4>Browser Import</h4>
                        <p style="color: var(--text-secondary); font-size: 14px;">Import from Chrome, Firefox, Safari bookmarks</p>
                    </div>
                    
                    <div class="import-option" onclick="importFromFile()">
                        <i class="fas fa-file-import" style="font-size: 32px; margin-bottom: 12px; color: var(--primary-500);"></i>
                        <h4>File Import</h4>
                        <p style="color: var(--text-secondary); font-size: 14px;">Import from JSON, CSV, HTML files</p>
                    </div>
                    
                    <div class="import-option" onclick="importFromClipboard()">
                        <i class="fas fa-clipboard" style="font-size: 32px; margin-bottom: 12px; color: var(--primary-500);"></i>
                        <h4>Clipboard Import</h4>
                        <p style="color: var(--text-secondary); font-size: 14px;">Paste URLs from clipboard</p>
                    </div>
                    
                    <div class="import-option" onclick="linkManager.showToast('Coming soon!', 'info')">
                        <i class="fas fa-cloud" style="font-size: 32px; margin-bottom: 12px; color: var(--primary-500);"></i>
                        <h4>Cloud Services</h4>
                        <p style="color: var(--text-secondary); font-size: 14px;">Import from Pocket, Raindrop, Instapaper</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Command Palette -->
    <div class="modal-overlay" id="commandPalette">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: var(--spacing-md); width: 100%;">
                    <i class="fas fa-search" style="color: var(--text-secondary);"></i>
                    <input type="text" 
                           class="form-input" 
                           placeholder="Type a command or search..."
                           id="commandInput"
                           style="border: none; background: transparent; padding: 0; width: 100%;">
                </div>
            </div>
            <div class="modal-body">
                <div id="commandResults"></div>
            </div>
        </div>
    </div>

    <!-- AI Assistant Modal -->
    <div class="modal-overlay" id="aiAssistantModal">
        <div class="modal" style="max-width: 800px; height: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-robot"></i> AI Assistant</h2>
                <button class="btn btn-icon" onclick="closeModal('aiAssistantModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" style="display: flex; flex-direction: column; height: calc(100% - 80px);">
                <div id="aiChat" style="flex: 1; overflow-y: auto; padding: var(--spacing-md); background: var(--surface-100); border-radius: var(--radius-lg); margin-bottom: var(--spacing-md);"></div>
                <div class="form-group" style="margin: 0;">
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <input type="text" 
                               class="form-input" 
                               id="aiQuery"
                               placeholder="Ask AI to organize, summarize, or find links..."
                               style="flex: 1;">
                        <button class="btn btn-primary" onclick="sendAIQuery()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="form-hint">Examples: "Find duplicate links", "Summarize my tech articles", "Organize by topic"</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Floating Bar -->
    <div class="floating-actions" style="position: fixed; bottom: var(--spacing-xl); right: var(--spacing-xl); display: flex; flex-direction: column; gap: var(--spacing-md); z-index: var(--z-fixed);">
        <button class="btn btn-primary btn-icon" onclick="openAddLinkModal()" title="Add Link">
            <i class="fas fa-plus"></i>
        </button>
        <button class="btn btn-secondary btn-icon" onclick="openAIOrganizeModal()" title="AI Assistant">
            <i class="fas fa-robot"></i>
        </button>
        <button class="btn btn-secondary btn-icon" onclick="scrollToTop()" title="Scroll to Top">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="linkManager.editLink()">
            <i class="fas fa-edit"></i>
            <span>Edit</span>
        </div>
        <div class="context-menu-item" onclick="linkManager.deleteLink()">
            <i class="fas fa-trash"></i>
            <span>Delete</span>
        </div>
        <div class="context-menu-item" onclick="linkManager.shareLink()">
            <i class="fas fa-share"></i>
            <span>Share</span>
        </div>
        <div class="context-menu-item" onclick="linkManager.archiveLink()">
            <i class="fas fa-archive"></i>
            <span>Archive</span>
        </div>
        <div class="context-menu-item" onclick="linkManager.toggleFavorite()">
            <i class="fas fa-star"></i>
            <span>Toggle Favorite</span>
        </div>
    </div>

    <script>
        // Enhanced Link Manager Pro v5.2 with Advanced AI
        class LinkManagerPro {
            constructor() {
                this.version = '5.2';
                this.storageKey = 'linkManagerPro_v5';
                this.data = {
                    links: [],
                    tags: [],
                    categories: ['General', 'Work', 'Personal', 'Learning', 'Entertainment'],
                    collections: [],
                    settings: {
                        theme: 'light',
                        aiEnabled: true,
                        autoFetchMetadata: true,
                        enableAnimations: true,
                        itemsPerPage: 20,
                        syncInterval: 5,
                        defaultView: 'grid',
                        enableVoiceSearch: true,
                        enableAI: true,
                        backupEnabled: true,
                        notifications: true
                    },
                    stats: {
                        totalLinks: 0,
                        totalClicks: 0,
                        storageUsed: 0,
                        aiRequests: 0,
                        lastBackup: null,
                        sessionCount: 1
                    },
                    user: {
                        id: this.generateUUID(),
                        name: 'User',
                        avatar: null,
                        preferences: {}
                    }
                };
                
                this.state = {
                    currentPage: 1,
                    selectedTags: new Set(),
                    searchQuery: '',
                    viewMode: 'grid',
                    isLoading: false,
                    selectedLinks: new Set(),
                    isSelecting: false,
                    sortBy: 'date',
                    sortOrder: 'desc',
                    filterBy: 'all',
                    totalPages: 1,
                    contextMenuLinkId: null
                };
                
                this.init();
            }
            
            async init() {
                await this.loadData();
                this.setupEventListeners();
                this.setupServiceWorker();
                this.render();
                this.showWelcomeMessage();
                this.startSync();
            }
            
            generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0;
                    const v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
            
            async loadData() {
                try {
                    const saved = localStorage.getItem(this.storageKey);
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.data = { ...this.data, ...parsed };
                    }
                    
                    // Load from IndexedDB if available
                    if ('indexedDB' in window) {
                        await this.loadFromIndexedDB();
                    }
                    
                    // Update tags from existing links
                    this.extractTagsFromLinks();
                    
                    return true;
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showToast('Error loading data', 'error');
                    return false;
                }
            }
            
            extractTagsFromLinks() {
                const allTags = new Set();
                this.data.links.forEach(link => {
                    link.tags?.forEach(tag => allTags.add(tag));
                });
                this.data.tags = Array.from(allTags);
            }
            
            async loadFromIndexedDB() {
                return new Promise((resolve, reject) => {
                    if (!('indexedDB' in window)) {
                        resolve();
                        return;
                    }
                    
                    const request = indexedDB.open('LinkManagerDB', 1);
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('links')) {
                            db.createObjectStore('links', { keyPath: 'id' });
                        }
                        if (!db.objectStoreNames.contains('settings')) {
                            db.createObjectStore('settings', { keyPath: 'id' });
                        }
                    };
                    
                    request.onsuccess = (event) => {
                        const db = event.target.result;
                        const transaction = db.transaction(['links'], 'readonly');
                        const store = transaction.objectStore('links');
                        const getAllRequest = store.getAll();
                        
                        getAllRequest.onsuccess = () => {
                            if (getAllRequest.result.length > 0) {
                                this.data.links = getAllRequest.result;
                            }
                            resolve();
                        };
                        
                        getAllRequest.onerror = () => {
                            console.warn('Failed to load from IndexedDB');
                            resolve();
                        };
                    };
                    
                    request.onerror = () => {
                        console.warn('IndexedDB not available');
                        resolve();
                    };
                });
            }
            
            async saveData() {
                try {
                    this.data.stats.totalLinks = this.data.links.length;
                    this.data.stats.totalClicks = this.data.links.reduce((sum, link) => sum + (link.clicks || 0), 0);
                    
                    // Save to localStorage
                    localStorage.setItem(this.storageKey, JSON.stringify(this.data));
                    
                    // Save to IndexedDB if available
                    if ('indexedDB' in window) {
                        await this.saveToIndexedDB();
                    }
                    
                    // Update stats display
                    this.updateStats();
                    
                    // Update pagination
                    this.updatePagination();
                    
                    // Trigger auto-backup if enabled
                    if (this.data.settings.backupEnabled) {
                        this.createBackup();
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error saving data:', error);
                    this.showToast('Error saving data', 'error');
                    return false;
                }
            }
            
            async saveToIndexedDB() {
                return new Promise((resolve, reject) => {
                    if (!('indexedDB' in window)) {
                        resolve();
                        return;
                    }
                    
                    const request = indexedDB.open('LinkManagerDB', 1);
                    
                    request.onsuccess = (event) => {
                        const db = event.target.result;
                        const transaction = db.transaction(['links'], 'readwrite');
                        const store = transaction.objectStore('links');
                        
                        // Clear existing data
                        store.clear();
                        
                        // Add all links
                        this.data.links.forEach(link => {
                            store.add(link);
                        });
                        
                        transaction.oncomplete = resolve;
                        transaction.onerror = () => {
                            console.warn('Failed to save to IndexedDB');
                            resolve();
                        };
                    };
                    
                    request.onerror = () => {
                        console.warn('IndexedDB not available');
                        resolve();
                    };
                });
            }
            
            setupEventListeners() {
                // Search with debounce and instant suggestions
                const searchInput = document.getElementById('searchInput');
                let searchTimeout;
                
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        clearTimeout(searchTimeout);
                        this.state.searchQuery = e.target.value;
                        
                        // Show instant suggestions
                        this.showInstantSuggestions(e.target.value);
                        
                        searchTimeout = setTimeout(() => {
                            this.state.currentPage = 1; // Reset to first page on new search
                            this.renderLinks();
                        }, 300);
                    });
                    
                    // Enter key to search
                    searchInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            this.state.currentPage = 1;
                            this.renderLinks();
                        }
                    });
                }
                
                // Theme switching
                document.querySelectorAll('.theme-switcher .action-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const theme = e.currentTarget.getAttribute('data-theme');
                        this.setTheme(theme);
                    });
                });
                
                // Voice search
                const voiceBtn = document.getElementById('voiceSearchBtn');
                if (voiceBtn) {
                    voiceBtn.addEventListener('click', () => {
                        this.startVoiceSearch();
                    });
                }
                
                // AI search
                const aiBtn = document.getElementById('aiSearchBtn');
                if (aiBtn) {
                    aiBtn.addEventListener('click', () => {
                        this.openAIAssistant();
                    });
                }
                
                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.state.filterBy = e.currentTarget.textContent.toLowerCase();
                        this.state.currentPage = 1;
                        this.renderLinks();
                    });
                });
                
                // Pagination
                const prevBtn = document.getElementById('prevPage');
                const nextBtn = document.getElementById('nextPage');
                
                if (prevBtn) {
                    prevBtn.addEventListener('click', () => {
                        if (this.state.currentPage > 1) {
                            this.state.currentPage--;
                            this.renderLinks();
                            this.updatePaginationControls();
                        }
                    });
                }
                
                if (nextBtn) {
                    nextBtn.addEventListener('click', () => {
                        if (this.state.currentPage < this.state.totalPages) {
                            this.state.currentPage++;
                            this.renderLinks();
                            this.updatePaginationControls();
                        }
                    });
                }
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Command/Ctrl + K for command palette
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                        e.preventDefault();
                        openCommandPalette();
                    }
                    
                    // Command/Ctrl + N for new link
                    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                        e.preventDefault();
                        openAddLinkModal();
                    }
                    
                    // Command/Ctrl + F for search
                    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                        e.preventDefault();
                        if (searchInput) {
                            searchInput.focus();
                            searchInput.select();
                        }
                    }
                    
                    // Escape to close modals
                    if (e.key === 'Escape') {
                        this.closeAllModals();
                        this.closeContextMenu();
                        this.clearSelection();
                    }
                    
                    // Bulk selection with Shift
                    if (e.key === 'Shift') {
                        this.state.isSelecting = true;
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    if (e.key === 'Shift') {
                        this.state.isSelecting = false;
                    }
                });
                
                // Context menu
                document.addEventListener('contextmenu', (e) => {
                    const linkCard = e.target.closest('.link-card');
                    if (linkCard) {
                        e.preventDefault();
                        const linkId = linkCard.dataset.id;
                        this.state.contextMenuLinkId = linkId;
                        this.showContextMenu(e.clientX, e.clientY);
                    }
                });
                
                // Click outside to close context menu
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.context-menu')) {
                        this.closeContextMenu();
                    }
                });
                
                // Auto-fetch metadata on URL input
                const urlInput = document.getElementById('linkUrl');
                if (urlInput) {
                    urlInput.addEventListener('blur', async (e) => {
                        if (e.target.value && this.data.settings.autoFetchMetadata) {
                            await this.autoFetchMetadata(e.target.value);
                        }
                    });
                }
            }
            
            setupServiceWorker() {
                if ('serviceWorker' in navigator && 'PushManager' in window) {
                    navigator.serviceWorker.register('/sw.js')
                        .then(registration => {
                            console.log('Service Worker registered:', registration);
                        })
                        .catch(error => {
                            console.error('Service Worker registration failed:', error);
                        });
                }
            }
            
            setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                this.data.settings.theme = theme;
                this.saveData();
                this.showToast(`Theme changed to ${theme}`, 'info');
            }
            
            async autoFetchMetadata(url) {
                try {
                    const titleInput = document.getElementById('linkTitle');
                    const descInput = document.getElementById('linkDescription');
                    
                    if (!titleInput || !descInput) return;
                    
                    // Show loading state
                    titleInput.value = 'Fetching metadata...';
                    descInput.value = 'Please wait...';
                    
                    // In a real app, you would fetch from an API
                    // This is a simulation
                    setTimeout(() => {
                        try {
                            const urlObj = new URL(url);
                            const hostname = urlObj.hostname.replace('www.', '');
                            
                            titleInput.value = `${hostname.charAt(0).toUpperCase() + hostname.slice(1)} - Web Resource`;
                            descInput.value = `A web resource from ${hostname}. Add your own description here.`;
                            
                            // Auto-suggest tags based on URL
                            this.suggestTagsFromUrl(url);
                            
                        } catch (error) {
                            titleInput.value = 'New Link';
                            descInput.value = '';
                        }
                    }, 800);
                    
                } catch (error) {
                    console.error('Error fetching metadata:', error);
                }
            }
            
            suggestTagsFromUrl(url) {
                try {
                    const urlObj = new URL(url);
                    const hostname = urlObj.hostname.toLowerCase();
                    const tagContainer = document.getElementById('tagContainer');
                    
                    if (!tagContainer) return;
                    
                    const suggestedTags = [];
                    
                    if (hostname.includes('github')) {
                        suggestedTags.push('development', 'code', 'git');
                    } else if (hostname.includes('youtube')) {
                        suggestedTags.push('video', 'tutorial');
                    } else if (hostname.includes('medium')) {
                        suggestedTags.push('article', 'blog');
                    } else if (hostname.includes('stackoverflow')) {
                        suggestedTags.push('programming', 'q&a');
                    }
                    
                    // Clear existing tags
                    tagContainer.innerHTML = '';
                    
                    // Add suggested tags
                    suggestedTags.forEach(tag => {
                        const badge = document.createElement('span');
                        badge.className = 'badge badge-clickable';
                        badge.textContent = tag;
                        badge.onclick = () => badge.remove();
                        tagContainer.appendChild(badge);
                    });
                    
                } catch (error) {
                    console.error('Error suggesting tags:', error);
                }
            }
            
            async addLink(linkData) {
                try {
                    const link = {
                        id: this.generateUUID(),
                        ...linkData,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        clicks: 0,
                        favorite: linkData.favorite || false,
                        tags: linkData.tags || [],
                        category: linkData.category || 'General',
                        metadata: {
                            favicon: null,
                            screenshot: null,
                            estimatedReadTime: null,
                            language: null
                        },
                        notes: '',
                        archived: false,
                        priority: 'medium'
                    };
                    
                    // Auto-fetch favicon
                    try {
                        const urlObj = new URL(link.url);
                        link.metadata.favicon = `https://www.google.com/s2/favicons?domain=${urlObj.hostname}&sz=128`;
                    } catch (error) {
                        // Invalid URL, continue without favicon
                    }
                    
                    // Estimate read time
                    if (link.description) {
                        const words = link.description.split(/\s+/).length;
                        link.metadata.estimatedReadTime = Math.ceil(words / 200);
                    }
                    
                    this.data.links.unshift(link);
                    await this.saveData();
                    this.renderLinks();
                    
                    this.showToast('Link added successfully!', 'success');
                    return link;
                } catch (error) {
                    console.error('Error adding link:', error);
                    this.showToast('Error adding link', 'error');
                    return null;
                }
            }
            
            renderLinks() {
                const container = document.getElementById('linkGrid');
                if (!container) return;
                
                let filteredLinks = [...this.data.links];
                
                // Apply search filter
                if (this.state.searchQuery) {
                    const query = this.state.searchQuery.toLowerCase();
                    filteredLinks = filteredLinks.filter(link => 
                        link.title.toLowerCase().includes(query) ||
                        link.url.toLowerCase().includes(query) ||
                        link.description?.toLowerCase().includes(query) ||
                        link.tags.some(tag => tag.toLowerCase().includes(query)) ||
                        link.category.toLowerCase().includes(query)
                    );
                }
                
                // Apply tag filter
                if (this.state.selectedTags.size > 0) {
                    filteredLinks = filteredLinks.filter(link =>
                        link.tags.some(tag => this.state.selectedTags.has(tag))
                    );
                }
                
                // Apply status filter
                switch (this.state.filterBy) {
                    case 'favorites':
                        filteredLinks = filteredLinks.filter(link => link.favorite);
                        break;
                    case 'unread':
                        filteredLinks = filteredLinks.filter(link => !link.read);
                        break;
                    case 'recent':
                        const lastWeek = new Date();
                        lastWeek.setDate(lastWeek.getDate() - 7);
                        filteredLinks = filteredLinks.filter(link => 
                            new Date(link.createdAt) > lastWeek
                        );
                        break;
                    case 'archived':
                        filteredLinks = filteredLinks.filter(link => link.archived);
                        break;
                }
                
                // Apply sorting
                filteredLinks.sort((a, b) => {
                    let comparison = 0;
                    
                    switch (this.state.sortBy) {
                        case 'date':
                            comparison = new Date(b.createdAt) - new Date(a.createdAt);
                            break;
                        case 'title':
                            comparison = a.title.localeCompare(b.title);
                            break;
                        case 'clicks':
                            comparison = (b.clicks || 0) - (a.clicks || 0);
                            break;
                        case 'priority':
                            const priorityOrder = { high: 3, medium: 2, low: 1 };
                            comparison = (priorityOrder[b.priority] || 0) - (priorityOrder[a.priority] || 0);
                            break;
                    }
                    
                    return this.state.sortOrder === 'desc' ? comparison : -comparison;
                });
                
                // Calculate pagination
                const totalItems = filteredLinks.length;
                const itemsPerPage = this.data.settings.itemsPerPage;
                this.state.totalPages = Math.ceil(totalItems / itemsPerPage) || 1;
                
                // Ensure current page is valid
                if (this.state.currentPage > this.state.totalPages) {
                    this.state.currentPage = this.state.totalPages || 1;
                }
                
                // Get current page items
                const startIndex = (this.state.currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const pageLinks = filteredLinks.slice(startIndex, endIndex);
                
                // Update pagination info
                this.updatePaginationControls();
                
                if (pageLinks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ðŸ”</div>
                            <h3>${this.state.searchQuery || this.state.selectedTags.size > 0 ? 'No links found' : 'Welcome to Link Manager Pro!'}</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 24px;">
                                ${this.state.searchQuery ? 'Try a different search or filter' : 'Start by adding your first link'}
                            </p>
                            ${!this.state.searchQuery && !this.state.selectedTags.size ? `
                                <button class="btn btn-primary" onclick="openAddLinkModal()">
                                    <i class="fas fa-plus"></i> Add Your First Link
                                </button>
                            ` : ''}
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = pageLinks.map(link => this.createLinkCard(link)).join('');
            }
            
            createLinkCard(link) {
                const isSelected = this.state.selectedLinks.has(link.id);
                const favicon = link.metadata?.favicon || 
                    `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="12">ðŸ”—</text></svg>`;
                
                return `
                    <div class="link-card ${isSelected ? 'selected' : ''} ${link.favorite ? 'favorite' : ''}" 
                         data-id="${link.id}"
                         onclick="linkManager.handleLinkClick(event, '${link.id}')"
                         draggable="true">
                        
                        <div class="link-card-header">
                            <div class="link-favicon">
                                <img src="${favicon}" alt="${this.escapeHtml(link.title)}" 
                                     onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><text x=\"50%\" y=\"50%\" dominant-baseline=\"middle\" text-anchor=\"middle\" font-size=\"12\">ðŸ”—</text></svg>'">
                            </div>
                            
                            <div class="link-actions">
                                <button class="action-btn" onclick="event.stopPropagation(); linkManager.toggleFavorite('${link.id}')">
                                    <i class="${link.favorite ? 'fas' : 'far'} fa-star"></i>
                                </button>
                                <button class="action-btn" onclick="event.stopPropagation(); linkManager.copyLink('${link.id}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="action-btn" onclick="event.stopPropagation(); linkManager.shareLink('${link.id}')">
                                    <i class="fas fa-share-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="link-preview" onclick="linkManager.openLink('${link.id}')">
                            <div class="preview-overlay">
                                <span style="color: white; font-weight: 600;">Open Link</span>
                            </div>
                        </div>
                        
                        <h4 class="truncate">${this.escapeHtml(link.title)}</h4>
                        
                        <p class="line-clamp-2" style="color: var(--text-secondary); margin-bottom: 12px;">
                            ${this.escapeHtml(link.description || 'No description')}
                        </p>
                        
                        <div class="link-meta">
                            <span class="badge">${this.escapeHtml(link.category)}</span>
                            ${link.tags.slice(0, 3).map(tag => `
                                <span class="badge badge-clickable" onclick="event.stopPropagation(); linkManager.filterByTag('${this.escapeHtml(tag)}')">
                                    ${this.escapeHtml(tag)}
                                </span>
                            `).join('')}
                            ${link.tags.length > 3 ? `<span class="badge">+${link.tags.length - 3}</span>` : ''}
                            
                            ${link.metadata?.estimatedReadTime ? `
                                <span class="badge">
                                    <i class="fas fa-clock"></i>
                                    ${link.metadata.estimatedReadTime} min
                                </span>
                            ` : ''}
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px;">
                            <span style="font-size: 12px; color: var(--text-tertiary);">
                                ${this.formatDate(link.createdAt)}
                            </span>
                            <span style="font-size: 12px; color: var(--text-tertiary);">
                                <i class="fas fa-mouse-pointer"></i> ${link.clicks || 0}
                            </span>
                        </div>
                    </div>
                `;
            }
            
            handleLinkClick(event, linkId) {
                // Don't trigger if clicking on action buttons
                if (event.target.closest('.action-btn') || event.target.closest('.link-preview')) {
                    return;
                }
                
                if (event.ctrlKey || event.metaKey || event.shiftKey) {
                    event.preventDefault();
                    this.toggleLinkSelection(linkId);
                } else {
                    // Regular click - open edit modal
                    this.editLink(linkId);
                }
            }
            
            toggleLinkSelection(linkId) {
                if (this.state.selectedLinks.has(linkId)) {
                    this.state.selectedLinks.delete(linkId);
                } else {
                    this.state.selectedLinks.add(linkId);
                }
                this.renderLinks();
                this.updateBulkActionsBar();
            }
            
            clearSelection() {
                this.state.selectedLinks.clear();
                this.renderLinks();
                this.updateBulkActionsBar();
            }
            
            updateBulkActionsBar() {
                const bar = document.getElementById('bulkActionsBar');
                const count = document.getElementById('selectedCount');
                
                if (bar && count) {
                    if (this.state.selectedLinks.size > 0) {
                        bar.style.display = 'block';
                        count.textContent = `${this.state.selectedLinks.size} link${this.state.selectedLinks.size === 1 ? '' : 's'} selected`;
                    } else {
                        bar.style.display = 'none';
                    }
                }
            }
            
            bulkArchive() {
                this.state.selectedLinks.forEach(linkId => {
                    const link = this.data.links.find(l => l.id === linkId);
                    if (link) {
                        link.archived = true;
                    }
                });
                this.saveData();
                this.renderLinks();
                this.clearSelection();
                this.showToast(`Archived ${this.state.selectedLinks.size} links`, 'success');
            }
            
            bulkTag() {
                const tag = prompt('Enter tag to add to selected links:');
                if (tag) {
                    this.state.selectedLinks.forEach(linkId => {
                        const link = this.data.links.find(l => l.id === linkId);
                        if (link && !link.tags.includes(tag)) {
                            link.tags.push(tag);
                        }
                    });
                    this.saveData();
                    this.renderLinks();
                    this.clearSelection();
                    this.showToast(`Added tag "${tag}" to ${this.state.selectedLinks.size} links`, 'success');
                }
            }
            
            bulkExport() {
                const selectedLinks = Array.from(this.state.selectedLinks).map(id => 
                    this.data.links.find(l => l.id === id)
                ).filter(Boolean);
                
                if (selectedLinks.length > 0) {
                    this.exportSelectedLinks(selectedLinks);
                }
            }
            
            async exportSelectedLinks(links) {
                const exportData = {
                    version: this.version,
                    exportDate: new Date().toISOString(),
                    links: links,
                    count: links.length
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `link-manager-export-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showToast(`Exported ${links.length} links`, 'success');
            }
            
            formatDate(dateString) {
                try {
                    const date = new Date(dateString);
                    const now = new Date();
                    const diffInDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
                    
                    if (diffInDays === 0) {
                        return 'Today';
                    } else if (diffInDays === 1) {
                        return 'Yesterday';
                    } else if (diffInDays < 7) {
                        return `${diffInDays} days ago`;
                    } else {
                        return date.toLocaleDateString();
                    }
                } catch (error) {
                    return 'Unknown date';
                }
            }
            
            updateStats() {
                const statTotal = document.getElementById('statTotal');
                const statActive = document.getElementById('statActive');
                const statStorage = document.getElementById('statStorage');
                
                if (statTotal) statTotal.textContent = this.data.links.length.toLocaleString();
                if (statActive) statActive.textContent = this.data.stats.sessionCount;
                
                // Calculate storage
                const dataSize = JSON.stringify(this.data).length;
                const sizeInMB = (dataSize / (1024 * 1024)).toFixed(2);
                if (statStorage) statStorage.textContent = `${sizeInMB} MB`;
                this.data.stats.storageUsed = parseFloat(sizeInMB);
            }
            
            updatePagination() {
                const totalItems = this.getFilteredLinksCount();
                const itemsPerPage = this.data.settings.itemsPerPage;
                this.state.totalPages = Math.ceil(totalItems / itemsPerPage) || 1;
                this.updatePaginationControls();
            }
            
            updatePaginationControls() {
                const prevBtn = document.getElementById('prevPage');
                const nextBtn = document.getElementById('nextPage');
                const pageInfo = document.getElementById('pageInfo');
                const paginationContainer = document.getElementById('paginationControls');
                
                if (prevBtn) {
                    prevBtn.disabled = this.state.currentPage <= 1;
                }
                
                if (nextBtn) {
                    nextBtn.disabled = this.state.currentPage >= this.state.totalPages;
                }
                
                if (pageInfo) {
                    pageInfo.textContent = `Page ${this.state.currentPage} of ${this.state.totalPages}`;
                }
                
                // Show/hide pagination
                if (paginationContainer) {
                    paginationContainer.style.display = this.state.totalPages > 1 ? 'flex' : 'none';
                }
            }
            
            getFilteredLinksCount() {
                let filteredLinks = [...this.data.links];
                
                if (this.state.searchQuery) {
                    const query = this.state.searchQuery.toLowerCase();
                    filteredLinks = filteredLinks.filter(link => 
                        link.title.toLowerCase().includes(query) ||
                        link.url.toLowerCase().includes(query) ||
                        link.description?.toLowerCase().includes(query) ||
                        link.tags.some(tag => tag.toLowerCase().includes(query)) ||
                        link.category.toLowerCase().includes(query)
                    );
                }
                
                return filteredLinks.length;
            }
            
            async startVoiceSearch() {
                if (!this.data.settings.enableVoiceSearch) {
                    this.showToast('Voice search is disabled in settings', 'warning');
                    return;
                }
                
                if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                    this.showToast('Voice search not supported in this browser', 'warning');
                    return;
                }
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                
                recognition.lang = 'en-US';
                recognition.interimResults = true;
                recognition.maxAlternatives = 1;
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput) {
                        searchInput.value = transcript;
                        this.state.searchQuery = transcript;
                        this.state.currentPage = 1;
                        this.renderLinks();
                    }
                };
                
                recognition.onerror = (event) => {
                    this.showToast('Voice recognition error', 'error');
                };
                
                recognition.start();
                this.showToast('Listening... Speak now', 'info');
            }
            
            showInstantSuggestions(query) {
                if (!query.trim()) {
                    const container = document.getElementById('searchSuggestions');
                    if (container) container.style.display = 'none';
                    return;
                }
                
                const suggestions = this.getSearchSuggestions(query);
                const container = document.getElementById('searchSuggestions');
                
                if (container && suggestions.length > 0) {
                    container.innerHTML = suggestions.map(s => `
                        <div class="multiselect-option" onclick="linkManager.applySearchSuggestion('${this.escapeHtml(s)}')">
                            <i class="fas fa-search" style="color: var(--text-tertiary); margin-right: 8px;"></i>
                            ${this.escapeHtml(s)}
                        </div>
                    `).join('');
                    container.style.display = 'block';
                } else if (container) {
                    container.style.display = 'none';
                }
            }
            
            getSearchSuggestions(query) {
                const lowerQuery = query.toLowerCase();
                const suggestions = new Set();
                
                // Add matching tags
                this.data.tags.forEach(tag => {
                    if (tag.toLowerCase().includes(lowerQuery)) {
                        suggestions.add(`#${tag}`);
                    }
                });
                
                // Add matching categories
                this.data.categories.forEach(cat => {
                    if (cat.toLowerCase().includes(lowerQuery)) {
                        suggestions.add(`Category: ${cat}`);
                    }
                });
                
                // Add recent searches
                const recentSearches = JSON.parse(localStorage.getItem('recentSearches') || '[]');
                recentSearches.forEach(search => {
                    if (search.toLowerCase().includes(lowerQuery)) {
                        suggestions.add(search);
                    }
                });
                
                // Add AI suggestions for longer queries
                if (query.length > 3) {
                    suggestions.add(`AI: Find links about ${query}`);
                    suggestions.add(`AI: Summarize ${query} links`);
                    suggestions.add(`AI: Organize ${query} by date`);
                }
                
                return Array.from(suggestions).slice(0, 8);
            }
            
            applySearchSuggestion(suggestion) {
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.value = suggestion;
                    this.state.searchQuery = suggestion;
                    this.state.currentPage = 1;
                    this.renderLinks();
                    
                    const suggestionsContainer = document.getElementById('searchSuggestions');
                    if (suggestionsContainer) suggestionsContainer.style.display = 'none';
                    
                    // Save to recent searches
                    this.saveRecentSearch(suggestion);
                }
            }
            
            saveRecentSearch(search) {
                const recentSearches = JSON.parse(localStorage.getItem('recentSearches') || '[]');
                const index = recentSearches.indexOf(search);
                
                if (index > -1) {
                    recentSearches.splice(index, 1);
                }
                
                recentSearches.unshift(search);
                
                if (recentSearches.length > 10) {
                    recentSearches.pop();
                }
                
                localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
            }
            
            openAIAssistant() {
                if (!this.data.settings.enableAI) {
                    this.showToast('AI features are disabled in settings', 'warning');
                    return;
                }
                
                openModal('aiAssistantModal');
                const chat = document.getElementById('aiChat');
                if (chat) {
                    chat.innerHTML = `
                        <div style="background: var(--surface-100); padding: 16px; border-radius: var(--radius-lg); margin-bottom: 12px;">
                            <strong><i class="fas fa-robot"></i> AI Assistant (v5.2):</strong>
                            <p style="margin-top: 8px;">Hello! I'm your advanced AI assistant. I can help you with:</p>
                            <ul style="margin-top: 8px; padding-left: 20px;">
                                <li>Finding and organizing links</li>
                                <li>Summarizing content</li>
                                <li>Detecting duplicates</li>
                                <li>Suggesting tags and categories</li>
                                <li>Analyzing your link patterns</li>
                                <li>Generating insights from your collection</li>
                            </ul>
                            <p style="margin-top: 8px;">What would you like me to help you with today?</p>
                        </div>
                    `;
                    
                    chat.scrollTop = chat.scrollHeight;
                }
            }
            
            async sendAIQuery() {
                const input = document.getElementById('aiQuery');
                const query = input?.value.trim();
                
                if (!query || !input) return;
                
                const chat = document.getElementById('aiChat');
                if (!chat) return;
                
                // Add user message
                chat.innerHTML += `
                    <div style="background: var(--primary-500); color: white; padding: 12px; border-radius: var(--radius-lg); margin-bottom: 12px; text-align: right;">
                        <strong>You:</strong>
                        <p style="margin-top: 4px;">${this.escapeHtml(query)}</p>
                    </div>
                `;
                
                input.value = '';
                
                // Show AI thinking indicator
                const thinkingId = 'thinking-' + Date.now();
                chat.innerHTML += `
                    <div id="${thinkingId}" style="background: var(--surface-100); padding: 12px; border-radius: var(--radius-lg); margin-bottom: 12px;">
                        <strong><i class="fas fa-robot"></i> AI Assistant:</strong>
                        <p style="margin-top: 4px;"><i class="fas fa-spinner fa-spin"></i> Analyzing your request...</p>
                    </div>
                `;
                
                chat.scrollTop = chat.scrollHeight;
                
                try {
                    // Simulate AI processing
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // Remove thinking indicator
                    const thinkingElement = document.getElementById(thinkingId);
                    if (thinkingElement) thinkingElement.remove();
                    
                    // Generate AI response
                    const response = await this.generateAIResponse(query);
                    chat.innerHTML += `
                        <div style="background: var(--surface-100); padding: 16px; border-radius: var(--radius-lg); margin-bottom: 12px;">
                            <strong><i class="fas fa-robot"></i> AI Assistant:</strong>
                            ${response}
                        </div>
                    `;
                    
                    chat.scrollTop = chat.scrollHeight;
                    
                    // Update AI request count
                    this.data.stats.aiRequests++;
                    this.saveData();
                    
                } catch (error) {
                    const thinkingElement = document.getElementById(thinkingId);
                    if (thinkingElement) thinkingElement.remove();
                    
                    chat.innerHTML += `
                        <div style="background: var(--surface-100); padding: 12px; border-radius: var(--radius-lg); margin-bottom: 12px; color: var(--danger-500);">
                            <strong><i class="fas fa-exclamation-circle"></i> Error:</strong>
                            <p style="margin-top: 4px;">Failed to process your request. Please try again.</p>
                        </div>
                    `;
                }
            }
            
            async generateAIResponse(query) {
                const lowerQuery = query.toLowerCase();
                
                // Enhanced AI responses with more capabilities
                if (lowerQuery.includes('duplicate') || lowerQuery.includes('duplicates')) {
                    const duplicates = this.findDuplicates();
                    if (duplicates.length > 0) {
                        return `
                            <p>I found ${duplicates.length} potential duplicate links in your collection.</p>
                            <p style="margin-top: 8px;">Here are the most common duplicates:</p>
                            <ul style="margin-top: 8px; padding-left: 20px;">
                                ${duplicates.slice(0, 3).map(d => `
                                    <li>"${this.escapeHtml(d.title)}" - ${d.count} occurrences</li>
                                `).join('')}
                            </ul>
                            <button class="btn btn-primary" onclick="linkManager.mergeDuplicates()" style="margin-top: 12px;">
                                <i class="fas fa-merge"></i> Merge All Duplicates
                            </button>
                        `;
                    } else {
                        return '<p>Great news! No duplicate links found in your collection.</p>';
                    }
                }
                
                if (lowerQuery.includes('summarize') || lowerQuery.includes('summary')) {
                    return `
                        <p>I've analyzed your link collection. Here's a summary:</p>
                        <ul style="margin-top: 8px; padding-left: 20px;">
                            <li>You have ${this.data.links.length} total links</li>
                            <li>${this.data.links.filter(l => l.favorite).length} are marked as favorites</li>
                            <li>Most links are in the "${this.getMostCommonCategory()}" category</li>
                            <li>Top tags: ${this.getTopTags(3).join(', ')}</li>
                        </ul>
                        <p style="margin-top: 12px;">Would you like me to:</p>
                        <div style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="linkManager.generateWeeklyReport()">
                                Generate Weekly Report
                            </button>
                            <button class="btn btn-secondary" onclick="linkManager.findTrendingTopics()">
                                Find Trending Topics
                            </button>
                            <button class="btn btn-secondary" onclick="linkManager.generateLinkInsights()">
                                Generate Insights
                            </button>
                        </div>
                    `;
                }
                
                if (lowerQuery.includes('organize') || lowerQuery.includes('categorize') || lowerQuery.includes('category')) {
                    const uncategorized = this.data.links.filter(l => l.category === 'General');
                    if (uncategorized.length > 0) {
                        return `
                            <p>I found ${uncategorized.length} links that could use better categorization.</p>
                            <p style="margin-top: 8px;">I can analyze their content and suggest appropriate categories and tags.</p>
                            <div style="display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="linkManager.suggestCategories()">
                                    <i class="fas fa-tags"></i> Suggest Categories
                                </button>
                                <button class="btn btn-secondary" onclick="linkManager.autoTagLinks()">
                                    <i class="fas fa-hashtag"></i> Auto-tag Links
                                </button>
                            </div>
                        `;
                    } else {
                        return '<p>All your links are already well categorized! Well done.</p>';
                    }
                }
                
                if (lowerQuery.includes('find') && (lowerQuery.includes('link') || lowerQuery.includes('links'))) {
                    const topic = this.extractTopicFromQuery(query);
                    if (topic) {
                        const matchingLinks = this.findLinksByTopic(topic);
                        if (matchingLinks.length > 0) {
                            return `
                                <p>I found ${matchingLinks.length} links about "${topic}":</p>
                                <ul style="margin-top: 8px; padding-left: 20px;">
                                    ${matchingLinks.slice(0, 5).map(link => `
                                        <li>
                                            <a href="#" onclick="linkManager.openLink('${link.id}'); return false;" style="color: var(--primary-500); text-decoration: none;">
                                                ${this.escapeHtml(link.title)}
                                            </a>
                                            - ${this.escapeHtml(link.category)}
                                        </li>
                                    `).join('')}
                                </ul>
                                ${matchingLinks.length > 5 ? `<p>... and ${matchingLinks.length - 5} more links.</p>` : ''}
                            `;
                        } else {
                            return `<p>I couldn't find any links about "${topic}". Try adding some or check your spelling.</p>`;
                        }
                    }
                }
                
                if (lowerQuery.includes('recent') || lowerQuery.includes('latest')) {
                    const recentLinks = this.getRecentLinks(5);
                    if (recentLinks.length > 0) {
                        return `
                            <p>Here are your ${recentLinks.length} most recent links:</p>
                            <ul style="margin-top: 8px; padding-left: 20px;">
                                ${recentLinks.map(link => `
                                    <li>
                                        <a href="#" onclick="linkManager.openLink('${link.id}'); return false;" style="color: var(--primary-500); text-decoration: none;">
                                            ${this.escapeHtml(link.title)}
                                        </a>
                                        - ${this.formatDate(link.createdAt)}
                                    </li>
                                `).join('')}
                            </ul>
                        `;
                    }
                }
                
                if (lowerQuery.includes('stat') || lowerQuery.includes('analytics')) {
                    return `
                        <p>Here are your link statistics:</p>
                        <ul style="margin-top: 8px; padding-left: 20px;">
                            <li>Total links: ${this.data.links.length}</li>
                            <li>Favorites: ${this.data.links.filter(l => l.favorite).length}</li>
                            <li>Categories: ${this.getCategoryCount()} different categories</li>
                            <li>Tags: ${this.data.tags.length} unique tags</li>
                            <li>Most active category: ${this.getMostCommonCategory()}</li>
                        </ul>
                        <button class="btn btn-primary" onclick="openAnalyticsModal()" style="margin-top: 12px;">
                            <i class="fas fa-chart-bar"></i> View Detailed Analytics
                        </button>
                    `;
                }
                
                // Advanced AI: Content analysis
                if (lowerQuery.includes('analyze') || lowerQuery.includes('analysis')) {
                    return `
                        <p>I can perform deep analysis on your link collection. Here's what I can analyze:</p>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 12px;">
                            <button class="btn btn-secondary" onclick="linkManager.analyzeLinkPatterns()">
                                <i class="fas fa-chart-pie"></i> Usage Patterns
                            </button>
                            <button class="btn btn-secondary" onclick="linkManager.analyzeContentThemes()">
                                <i class="fas fa-palette"></i> Content Themes
                            </button>
                            <button class="btn btn-secondary" onclick="linkManager.analyzeLinkQuality()">
                                <i class="fas fa-star"></i> Link Quality
                            </button>
                            <button class="btn btn-secondary" onclick="linkManager.generateRecommendations()">
                                <i class="fas fa-lightbulb"></i> Recommendations
                            </button>
                        </div>
                    `;
                }
                
                // Default response with enhanced suggestions
                return `
                    <p>I understand you're asking about "${this.escapeHtml(query)}". I'm your advanced AI assistant with these capabilities:</p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 12px;">
                        <button class="btn btn-secondary" onclick="linkManager.findSimilarLinks('${this.escapeHtml(query)}')">
                            Find Similar Links
                        </button>
                        <button class="btn btn-secondary" onclick="linkManager.analyzeLinkPatterns()">
                            Analyze Patterns
                        </button>
                        <button class="btn btn-secondary" onclick="linkManager.cleanUpOldLinks()">
                            Clean Up Old Links
                        </button>
                        <button class="btn btn-secondary" onclick="linkManager.generateTopicReport('${this.escapeHtml(query)}')">
                            Generate Report
                        </button>
                        <button class="btn btn-secondary" onclick="linkManager.suggestRelatedContent()">
                            Suggest Related Content
                        </button>
                        <button class="btn btn-secondary" onclick="linkManager.optimizeCollection()">
                            Optimize Collection
                        </button>
                    </div>
                    <p style="margin-top: 12px;">You can also ask me specific questions like:</p>
                    <ul style="margin-top: 4px; padding-left: 20px; font-size: 14px; color: var(--text-secondary);">
                        <li>"Find all tutorial links"</li>
                        <li>"Show me links from last week"</li>
                        <li>"What are my most visited links?"</li>
                        <li>"Organize my work-related links"</li>
                    </ul>
                `;
            }
            
            getMostCommonCategory() {
                const categories = this.data.links.map(l => l.category);
                const counts = {};
                categories.forEach(cat => {
                    counts[cat] = (counts[cat] || 0) + 1;
                });
                
                return Object.entries(counts).sort((a, b) => b[1] - a[1])[0]?.[0] || 'General';
            }
            
            getTopTags(count = 5) {
                const tagCounts = {};
                this.data.links.forEach(link => {
                    link.tags?.forEach(tag => {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    });
                });
                
                return Object.entries(tagCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, count)
                    .map(([tag]) => tag);
            }
            
            getCategoryCount() {
                const categories = new Set(this.data.links.map(l => l.category));
                return categories.size;
            }
            
            extractTopicFromQuery(query) {
                const phrases = ['find links about', 'find links on', 'show me links about', 'links about'];
                for (const phrase of phrases) {
                    if (query.toLowerCase().includes(phrase)) {
                        return query.toLowerCase().split(phrase)[1]?.trim();
                    }
                }
                return null;
            }
            
            findLinksByTopic(topic) {
                topic = topic.toLowerCase();
                return this.data.links.filter(link => 
                    link.title.toLowerCase().includes(topic) ||
                    link.description?.toLowerCase().includes(topic) ||
                    link.tags.some(tag => tag.toLowerCase().includes(tag)) ||
                    link.category.toLowerCase().includes(topic)
                );
            }
            
            getRecentLinks(count = 5) {
                return [...this.data.links]
                    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                    .slice(0, count);
            }
            
            findDuplicates() {
                const urlMap = new Map();
                
                this.data.links.forEach(link => {
                    try {
                        // Normalize URL
                        const urlObj = new URL(link.url);
                        const normalizedUrl = urlObj.hostname + urlObj.pathname;
                        
                        if (!urlMap.has(normalizedUrl)) {
                            urlMap.set(normalizedUrl, []);
                        }
                        urlMap.get(normalizedUrl).push(link);
                    } catch (error) {
                        // Invalid URL, skip
                    }
                });
                
                return Array.from(urlMap.entries())
                    .filter(([_, links]) => links.length > 1)
                    .map(([url, links]) => ({
                        url,
                        title: links[0].title,
                        count: links.length,
                        links: links.map(l => l.id)
                    }));
            }
            
            async mergeDuplicates() {
                const duplicates = this.findDuplicates();
                let mergedCount = 0;
                
                for (const dup of duplicates) {
                    // Keep the most complete link
                    const bestLink = dup.links.reduce((best, linkId) => {
                        const link = this.data.links.find(l => l.id === linkId);
                        const score = (link.title ? 1 : 0) + 
                                     (link.description ? 1 : 0) + 
                                     (link.tags.length ? 1 : 0);
                        const bestScore = (best.title ? 1 : 0) + 
                                         (best.description ? 1 : 0) + 
                                         (best.tags.length ? 1 : 0);
                        return score > bestScore ? link : best;
                    });
                    
                    // Remove all but the best link
                    this.data.links = this.data.links.filter(l => 
                        !dup.links.includes(l.id) || l.id === bestLink.id
                    );
                    
                    // Update the kept link with combined information
                    const allTags = new Set(bestLink.tags);
                    dup.links.forEach(linkId => {
                        const link = this.data.links.find(l => l.id === linkId);
                        if (link && link !== bestLink) {
                            link.tags?.forEach(tag => allTags.add(tag));
                            bestLink.clicks += link.clicks || 0;
                        }
                    });
                    
                    bestLink.tags = Array.from(allTags);
                    mergedCount += dup.count - 1;
                }
                
                await this.saveData();
                this.renderLinks();
                this.showToast(`Successfully merged ${mergedCount} duplicate links`, 'success');
                closeModal('aiAssistantModal');
            }
            
            async suggestCategories() {
                this.showToast('AI is analyzing your links...', 'info');
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                let updatedCount = 0;
                this.data.links.forEach(link => {
                    if (link.category === 'General') {
                        const url = link.url.toLowerCase();
                        if (url.includes('github') || url.includes('gitlab') || url.includes('stackoverflow')) {
                            link.category = 'Development';
                            updatedCount++;
                        } else if (url.includes('youtube') || url.includes('netflix') || url.includes('spotify')) {
                            link.category = 'Entertainment';
                            updatedCount++;
                        } else if (url.includes('medium') || url.includes('wikipedia') || url.includes('coursera')) {
                            link.category = 'Learning';
                            updatedCount++;
                        } else if (url.includes('linkedin') || url.includes('indeed') || url.includes('glassdoor')) {
                            link.category = 'Work';
                            updatedCount++;
                        }
                    }
                });
                
                await this.saveData();
                this.renderLinks();
                this.showToast(`AI categorized ${updatedCount} links`, 'success');
            }
            
            async autoTagLinks() {
                this.showToast('AI is analyzing and tagging your links...', 'info');
                
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                let taggedCount = 0;
                this.data.links.forEach(link => {
                    const url = link.url.toLowerCase();
                    const tags = new Set(link.tags);
                    
                    // Add tags based on URL patterns
                    if (url.includes('tutorial') || url.includes('how-to') || url.includes('guide')) {
                        tags.add('tutorial');
                    }
                    if (url.includes('docs') || url.includes('documentation')) {
                        tags.add('documentation');
                    }
                    if (url.includes('api') || url.includes('developer')) {
                        tags.add('api');
                    }
                    if (url.includes('blog') || url.includes('article')) {
                        tags.add('blog');
                    }
                    if (url.includes('video') || url.includes('youtube')) {
                        tags.add('video');
                    }
                    
                    if (tags.size > link.tags.length) {
                        link.tags = Array.from(tags);
                        taggedCount++;
                    }
                });
                
                await this.saveData();
                this.renderLinks();
                this.showToast(`AI added tags to ${taggedCount} links`, 'success');
            }
            
            showContextMenu(x, y) {
                const menu = document.getElementById('contextMenu');
                if (!menu) return;
                
                // Position the menu
                menu.style.left = Math.min(x, window.innerWidth - 250) + 'px';
                menu.style.top = Math.min(y, window.innerHeight - 300) + 'px';
                menu.style.display = 'block';
            }
            
            closeContextMenu() {
                const menu = document.getElementById('contextMenu');
                if (menu) {
                    menu.style.display = 'none';
                }
                this.state.contextMenuLinkId = null;
            }
            
            editLink() {
                if (!this.state.contextMenuLinkId) return;
                
                const link = this.data.links.find(l => l.id === this.state.contextMenuLinkId);
                if (!link) return;
                
                // Populate the edit modal
                const urlInput = document.getElementById('linkUrl');
                const titleInput = document.getElementById('linkTitle');
                const descInput = document.getElementById('linkDescription');
                const categorySelect = document.getElementById('linkCategory');
                const favoriteCheckbox = document.getElementById('linkFavorite');
                const tagContainer = document.getElementById('tagContainer');
                
                if (urlInput) urlInput.value = link.url;
                if (titleInput) titleInput.value = link.title;
                if (descInput) descInput.value = link.description || '';
                if (categorySelect) categorySelect.value = link.category;
                if (favoriteCheckbox) favoriteCheckbox.checked = link.favorite;
                
                // Populate tags
                if (tagContainer) {
                    tagContainer.innerHTML = '';
                    link.tags.forEach(tag => {
                        const badge = document.createElement('span');
                        badge.className = 'badge badge-clickable';
                        badge.textContent = tag;
                        badge.onclick = () => badge.remove();
                        tagContainer.appendChild(badge);
                    });
                }
                
                // Change modal to edit mode
                const modal = document.getElementById('addLinkModal');
                const modalTitle = modal.querySelector('h2');
                if (modalTitle) modalTitle.textContent = 'Edit Link';
                
                // Change submit button
                const submitBtn = modal.querySelector('.btn-primary');
                if (submitBtn) {
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Link';
                    submitBtn.onclick = (e) => {
                        e.preventDefault();
                        this.updateLink(link.id);
                    };
                }
                
                openModal('addLinkModal');
                this.closeContextMenu();
            }
            
            async updateLink(linkId) {
                const link = this.data.links.find(l => l.id === linkId);
                if (!link) return;
                
                // Get updated values
                const urlInput = document.getElementById('linkUrl');
                const titleInput = document.getElementById('linkTitle');
                const descInput = document.getElementById('linkDescription');
                const categorySelect = document.getElementById('linkCategory');
                const favoriteCheckbox = document.getElementById('linkFavorite');
                const tagContainer = document.getElementById('tagContainer');
                
                if (urlInput) link.url = urlInput.value;
                if (titleInput) link.title = titleInput.value;
                if (descInput) link.description = descInput.value;
                if (categorySelect) link.category = categorySelect.value;
                if (favoriteCheckbox) link.favorite = favoriteCheckbox.checked;
                
                // Get tags
                if (tagContainer) {
                    link.tags = Array.from(tagContainer.querySelectorAll('.badge'))
                        .map(badge => badge.textContent.trim());
                }
                
                link.updatedAt = new Date().toISOString();
                
                await this.saveData();
                this.renderLinks();
                this.showToast('Link updated successfully!', 'success');
                closeModal('addLinkModal');
                
                // Reset modal for next use
                setTimeout(() => {
                    const modalTitle = document.querySelector('#addLinkModal h2');
                    if (modalTitle) modalTitle.textContent = 'Add New Link';
                    
                    const submitBtn = document.querySelector('#addLinkModal .btn-primary');
                    if (submitBtn) {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Save Link';
                        submitBtn.onclick = (e) => {
                            e.preventDefault();
                            saveLink(e);
                        };
                    }
                }, 300);
            }
            
            deleteLink() {
                if (!this.state.contextMenuLinkId) return;
                
                if (confirm('Are you sure you want to delete this link?')) {
                    this.data.links = this.data.links.filter(l => l.id !== this.state.contextMenuLinkId);
                    this.saveData();
                    this.renderLinks();
                    this.showToast('Link deleted successfully', 'success');
                    this.closeContextMenu();
                }
            }
            
            archiveLink() {
                if (!this.state.contextMenuLinkId) return;
                
                const link = this.data.links.find(l => l.id === this.state.contextMenuLinkId);
                if (link) {
                    link.archived = !link.archived;
                    this.saveData();
                    this.renderLinks();
                    this.showToast(link.archived ? 'Link archived' : 'Link unarchived', 'info');
                    this.closeContextMenu();
                }
            }
            
            toggleFavorite(linkId = null) {
                const id = linkId || this.state.contextMenuLinkId;
                if (!id) return;
                
                const link = this.data.links.find(l => l.id === id);
                if (link) {
                    link.favorite = !link.favorite;
                    this.saveData();
                    this.renderLinks();
                    this.showToast(link.favorite ? 'Added to favorites' : 'Removed from favorites', 'info');
                }
                
                if (this.state.contextMenuLinkId) {
                    this.closeContextMenu();
                }
            }
            
            copyLink(linkId) {
                const link = this.data.links.find(l => l.id === linkId);
                if (link) {
                    navigator.clipboard.writeText(link.url).then(() => {
                        this.showToast('Link copied to clipboard', 'success');
                    }).catch(err => {
                        console.error('Failed to copy link:', err);
                        this.showToast('Failed to copy link', 'error');
                    });
                }
            }
            
            shareLink(linkId) {
                const link = this.data.links.find(l => l.id === linkId);
                if (link && navigator.share) {
                    navigator.share({
                        title: link.title,
                        text: link.description,
                        url: link.url
                    }).then(() => {
                        this.showToast('Link shared successfully', 'success');
                    }).catch(err => {
                        console.error('Failed to share link:', err);
                        this.showToast('Failed to share link', 'error');
                    });
                } else {
                    this.copyLink(linkId);
                }
            }
            
            openLink(linkId) {
                const link = this.data.links.find(l => l.id === linkId);
                if (link) {
                    // Track click
                    link.clicks = (link.clicks || 0) + 1;
                    this.saveData();
                    
                    // Open in new tab
                    window.open(link.url, '_blank');
                }
            }
            
            filterByTag(tag) {
                // Remove # if present
                const cleanTag = tag.replace(/^#/, '');
                this.state.selectedTags.add(cleanTag);
                this.state.currentPage = 1;
                this.renderLinks();
                this.showToast(`Filtering by tag: ${cleanTag}`, 'info');
            }
            
            async createBackup() {
                const backup = {
                    version: this.version,
                    timestamp: new Date().toISOString(),
                    data: this.data
                };
                
                // Save to localStorage backups
                const backups = JSON.parse(localStorage.getItem('linkManagerBackups') || '[]');
                backups.unshift(backup);
                
                if (backups.length > 10) {
                    backups.pop();
                }
                
                localStorage.setItem('linkManagerBackups', JSON.stringify(backups));
                this.data.stats.lastBackup = new Date().toISOString();
                
                console.log('Backup created:', backup.timestamp);
            }
            
            startSync() {
                // Simulate real-time sync
                setInterval(() => {
                    if (navigator.onLine) {
                        this.data.stats.sessionCount = Math.floor(Math.random() * 3) + 1;
                        this.updateStats();
                    }
                }, 30000);
            }
            
            async exportData(format = 'json') {
                const data = {
                    ...this.data,
                    exportDate: new Date().toISOString(),
                    exportFormat: format
                };
                
                let content, mimeType, extension;
                
                switch (format) {
                    case 'json':
                        content = JSON.stringify(data, null, 2);
                        mimeType = 'application/json';
                        extension = 'json';
                        break;
                    case 'csv':
                        content = this.convertToCSV(data.links);
                        mimeType = 'text/csv';
                        extension = 'csv';
                        break;
                    case 'html':
                        content = this.convertToHTML(data.links);
                        mimeType = 'text/html';
                        extension = 'html';
                        break;
                    default:
                        throw new Error('Unsupported format');
                }
                
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `link-manager-export-${new Date().toISOString().split('T')[0]}.${extension}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showToast(`Data exported as ${format.toUpperCase()}`, 'success');
            }
            
            convertToCSV(links) {
                const headers = ['Title', 'URL', 'Description', 'Category', 'Tags', 'Created At', 'Clicks'];
                const rows = links.map(link => [
                    `"${(link.title || '').replace(/"/g, '""')}"`,
                    `"${(link.url || '').replace(/"/g, '""')}"`,
                    `"${(link.description || '').replace(/"/g, '""')}"`,
                    `"${link.category || ''}"`,
                    `"${(link.tags || []).join(', ')}"`,
                    `"${link.createdAt || ''}"`,
                    link.clicks || 0
                ]);
                
                return [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
            }
            
            convertToHTML(links) {
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Link Manager Export</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 40px; }
                            h1 { color: #333; }
                            .link { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
                            .link h3 { margin: 0 0 10px 0; }
                            .meta { color: #666; font-size: 14px; }
                        </style>
                    </head>
                    <body>
                        <h1>Link Manager Export (${links.length} links)</h1>
                        ${links.map(link => `
                            <div class="link">
                                <h3><a href="${this.escapeHtml(link.url)}">${this.escapeHtml(link.title)}</a></h3>
                                <p>${this.escapeHtml(link.description || '')}</p>
                                <div class="meta">
                                    Category: ${this.escapeHtml(link.category)} | 
                                    Tags: ${this.escapeHtml((link.tags || []).join(', '))} | 
                                    Added: ${new Date(link.createdAt).toLocaleDateString()} | 
                                    Clicks: ${link.clicks || 0}
                                </div>
                            </div>
                        `).join('')}
                    </body>
                    </html>
                `;
            }
            
            showToast(message, type = 'info') {
                if (!this.data.settings.notifications) return;
                
                const container = document.getElementById('toastContainer');
                if (!container) return;
                
                const toast = document.createElement('div');
                
                const icons = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-circle',
                    warning: 'fas fa-exclamation-triangle',
                    info: 'fas fa-info-circle'
                };
                
                const colors = {
                    success: 'var(--success-500)',
                    error: 'var(--danger-500)',
                    warning: 'var(--warning-500)',
                    info: 'var(--info-500)'
                };
                
                toast.className = 'toast';
                toast.style.borderLeft = `4px solid ${colors[type]}`;
                toast.innerHTML = `
                    <i class="${icons[type] || icons.info}" style="color: ${colors[type]}; font-size: 20px;"></i>
                    <span>${this.escapeHtml(message)}</span>
                `;
                
                container.appendChild(toast);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    toast.style.animation = 'slideUp 0.3s ease-out forwards';
                    setTimeout(() => {
                        if (toast.parentNode === container) {
                            container.removeChild(toast);
                        }
                    }, 300);
                }, 5000);
            }
            
            showWelcomeMessage() {
                if (!localStorage.getItem('linkManager_v5_welcome')) {
                    setTimeout(() => {
                        this.showToast('Welcome to Link Manager Pro v5.2! Use Ctrl+K to open command palette.', 'info');
                        localStorage.setItem('linkManager_v5_welcome', 'true');
                    }, 1000);
                }
            }
            
            closeAllModals() {
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
            
            escapeHtml(text) {
                if (text === null || text === undefined) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            render() {
                this.updateStats();
                this.renderLinks();
                this.updatePagination();
                
                // Apply saved theme
                this.setTheme(this.data.settings.theme);
            }
            
            // Enhanced AI Methods
            generateWeeklyReport() {
                this.showToast('Generating weekly report...', 'info');
                // Implementation would generate a detailed report
                setTimeout(() => {
                    this.showToast('Weekly report generated! Check your downloads.', 'success');
                }, 2000);
            }
            
            findTrendingTopics() {
                const tags = this.getTopTags(5);
                this.showToast(`Trending topics: ${tags.join(', ')}`, 'info');
            }
            
            generateLinkInsights() {
                const insights = [
                    `You have ${this.data.links.length} links total`,
                    `Top category: ${this.getMostCommonCategory()}`,
                    `Most used tag: ${this.getTopTags(1)[0] || 'None yet'}`,
                    `Links added this month: ${this.getRecentLinks(30).length}`
                ];
                alert(`Link Insights:\n\n${insights.join('\nâ€¢ ')}`);
            }
            
            analyzeLinkPatterns() {
                this.showToast('Analyzing your link patterns...', 'info');
                setTimeout(() => {
                    const patterns = this.analyzePatterns();
                    alert(`Link Patterns Analysis:\n\nâ€¢ ${patterns.join('\nâ€¢ ')}`);
                }, 2000);
            }
            
            analyzePatterns() {
                const patterns = [];
                const hourCounts = new Array(24).fill(0);
                
                this.data.links.forEach(link => {
                    const hour = new Date(link.createdAt).getHours();
                    hourCounts[hour]++;
                });
                
                const peakHour = hourCounts.indexOf(Math.max(...hourCounts));
                patterns.push(`Peak link saving time: ${peakHour}:00`);
                patterns.push(`Most links saved during: ${peakHour >= 9 && peakHour <= 17 ? 'work hours' : 'evenings'}`);
                
                return patterns;
            }
        }

        // Global functions
        let linkManager;

        function openAddLinkModal() {
            // Reset form
            const form = document.getElementById('linkForm');
            if (form) form.reset();
            
            const tagContainer = document.getElementById('tagContainer');
            if (tagContainer) tagContainer.innerHTML = '';
            
            const favoriteCheckbox = document.getElementById('linkFavorite');
            if (favoriteCheckbox) favoriteCheckbox.checked = false;
            
            openModal('addLinkModal');
        }

        function openCommandPalette() {
            openModal('commandPalette');
            const commandInput = document.getElementById('commandInput');
            if (commandInput) {
                commandInput.focus();
                commandInput.value = '';
            }
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function openImportModal() {
            openModal('importModal');
        }

        function openAIOrganizeModal() {
            if (linkManager) {
                linkManager.openAIAssistant();
            }
        }

        function openAnalyticsModal() {
            if (linkManager) {
                linkManager.showToast('Opening analytics dashboard...', 'info');
            }
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function saveLink(event) {
            event.preventDefault();
            
            const url = document.getElementById('linkUrl')?.value;
            const title = document.getElementById('linkTitle')?.value;
            const description = document.getElementById('linkDescription')?.value;
            const category = document.getElementById('linkCategory')?.value;
            const favorite = document.getElementById('linkFavorite')?.checked;
            
            // Get tags from tag container
            const tags = Array.from(document.querySelectorAll('#tagContainer .badge'))
                .map(tag => tag.textContent.trim());
            
            if (!url || !title) {
                linkManager.showToast('URL and Title are required', 'error');
                return;
            }
            
            await linkManager.addLink({
                url,
                title,
                description,
                category,
                favorite,
                tags
            });
            
            closeModal('addLinkModal');
            
            // Reset form
            event.target.reset();
            const tagContainer = document.getElementById('tagContainer');
            if (tagContainer) tagContainer.innerHTML = '';
            const favoriteCheckbox = document.getElementById('linkFavorite');
            if (favoriteCheckbox) favoriteCheckbox.checked = false;
        }

        function importFromBrowser() {
            if (linkManager) {
                linkManager.showToast('Browser import requires extension installation', 'info');
            }
        }

        function importFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.csv,.html,.txt';
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const text = await file.text();
                    try {
                        const data = JSON.parse(text);
                        if (data.links && Array.isArray(data.links)) {
                            let importedCount = 0;
                            for (const link of data.links) {
                                await linkManager.addLink(link);
                                importedCount++;
                            }
                            linkManager.showToast(`Imported ${importedCount} links`, 'success');
                            closeModal('importModal');
                        } else {
                            linkManager.showToast('Invalid file format', 'error');
                        }
                    } catch (error) {
                        // Try CSV import
                        if (file.name.endsWith('.csv')) {
                            await linkManager.importCSV(text);
                        } else {
                            linkManager.showToast('Failed to parse file', 'error');
                        }
                    }
                }
            };
            
            input.click();
        }

        function importFromClipboard() {
            navigator.clipboard.readText().then(text => {
                const lines = text.split('\n').filter(line => line.trim());
                let importedCount = 0;
                
                lines.forEach(line => {
                    if (line.startsWith('http')) {
                        try {
                            new URL(line.trim()); // Validate URL
                            linkManager.addLink({
                                url: line.trim(),
                                title: new URL(line).hostname,
                                category: 'Imported'
                            });
                            importedCount++;
                        } catch (error) {
                            // Invalid URL, skip
                        }
                    }
                });
                
                if (importedCount > 0) {
                    linkManager.showToast(`Imported ${importedCount} links from clipboard`, 'success');
                    closeModal('importModal');
                } else {
                    linkManager.showToast('No valid URLs found in clipboard', 'warning');
                }
            }).catch(err => {
                linkManager.showToast('Failed to read clipboard', 'error');
            });
        }

        function sendAIQuery() {
            if (linkManager) {
                linkManager.sendAIQuery();
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            linkManager = new LinkManagerPro();
            
            // Add tag input functionality
            const tagInput = document.getElementById('tagInput');
            const tagContainer = document.getElementById('tagContainer');
            
            tagInput?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    const tag = tagInput.value.trim().replace(/,/g, '');
                    if (tag) {
                        // Check for duplicates
                        const existingTags = Array.from(tagContainer.querySelectorAll('.badge'))
                            .map(badge => badge.textContent.trim());
                        
                        if (!existingTags.includes(tag)) {
                            const badge = document.createElement('span');
                            badge.className = 'badge badge-clickable';
                            badge.textContent = tag;
                            badge.onclick = () => badge.remove();
                            tagContainer.appendChild(badge);
                            tagInput.value = '';
                        } else {
                            linkManager.showToast('Tag already added', 'warning');
                        }
                    }
                }
            });
            
            // Command palette functionality
            const commandInput = document.getElementById('commandInput');
            commandInput?.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const results = document.getElementById('commandResults');
                
                if (!results) return;
                
                const commands = [
                    { name: 'Add New Link', icon: 'plus', action: openAddLinkModal, shortcut: 'Ctrl+N' },
                    { name: 'Open AI Assistant', icon: 'robot', action: openAIOrganizeModal, shortcut: 'Ctrl+J' },
                    { name: 'Export Data as JSON', icon: 'download', action: () => linkManager.exportData('json') },
                    { name: 'Export Data as CSV', icon: 'file-csv', action: () => linkManager.exportData('csv') },
                    { name: 'Import Links', icon: 'upload', action: openImportModal },
                    { name: 'Toggle Light Mode', icon: 'sun', action: () => linkManager.setTheme('light') },
                    { name: 'Toggle Dark Mode', icon: 'moon', action: () => linkManager.setTheme('dark') },
                    { name: 'Toggle Midnight Mode', icon: 'stars', action: () => linkManager.setTheme('midnight') },
                    { name: 'Clear Search', icon: 'times', action: () => {
                        const searchInput = document.getElementById('searchInput');
                        if (searchInput) {
                            searchInput.value = '';
                            linkManager.state.searchQuery = '';
                            linkManager.state.currentPage = 1;
                            linkManager.renderLinks();
                        }
                    }},
                    { name: 'View Statistics', icon: 'chart-line', action: openAnalyticsModal },
                    { name: 'Settings', icon: 'cog', action: () => linkManager.showToast('Settings coming soon', 'info') }
                ];
                
                const filtered = commands.filter(cmd => 
                    cmd.name.toLowerCase().includes(query)
                );
                
                results.innerHTML = filtered.map(cmd => `
                    <div class="context-menu-item" onclick="${cmd.action.name}(); closeModal('commandPalette');">
                        <i class="fas fa-${cmd.icon}"></i>
                        <span style="flex: 1;">${cmd.name}</span>
                        <span class="shortcut">${cmd.shortcut}</span>
                    </div>
                `).join('');
                
                if (filtered.length === 0) {
                    results.innerHTML = `
                        <div class="context-menu-item" style="color: var(--text-tertiary); cursor: default;">
                            <i class="fas fa-search"></i>
                            <span>No commands found</span>
                        </div>
                    `;
                }
            });
            
            commandInput?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const firstItem = document.querySelector('#commandResults .context-menu-item');
                    if (firstItem && !firstItem.style.color) {
                        firstItem.click();
                    }
                }
                if (e.key === 'Escape') {
                    closeModal('commandPalette');
                }
            });
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            });
            
            // Prevent form submission on Enter in search
            const searchInput = document.getElementById('searchInput');
            searchInput?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                }
            });
        });

        // Add global error handler
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            if (linkManager) {
                linkManager.showToast('An error occurred. Please refresh the page.', 'error');
            }
        });

        // Handle offline/online status
        window.addEventListener('online', () => {
            if (linkManager) {
                linkManager.showToast('You are back online', 'success');
            }
        });

        window.addEventListener('offline', () => {
            if (linkManager) {
                linkManager.showToast('You are offline. Some features may be limited.', 'warning');
            }
        });
    </script>
</body>
</html>